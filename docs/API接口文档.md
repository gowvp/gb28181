# GoWVP API æ¥å£æ–‡æ¡£

GoWVP æ˜¯ Go è¯­è¨€å®ç°çš„å¼€æº GB28181 è§£å†³æ–¹æ¡ˆï¼Œæœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†æ‰€æœ‰å¯ç”¨çš„ API æ¥å£ã€‚

ğŸ“– **åœ¨çº¿ API æ–‡æ¡£**: [Apifox åœ¨çº¿æ–‡æ¡£](https://apifox.com/apidoc/shared-7b67c918-5f72-4f64-b71d-0593d7427b93)

## ç›®å½•

- [è®¤è¯æœºåˆ¶](#è®¤è¯æœºåˆ¶)
- [ç”¨æˆ·ç®¡ç†](#ç”¨æˆ·ç®¡ç†)
- [è®¾å¤‡ç®¡ç†](#è®¾å¤‡ç®¡ç†)
- [é€šé“ç®¡ç†](#é€šé“ç®¡ç†)
- [æµåª’ä½“æœåŠ¡å™¨](#æµåª’ä½“æœåŠ¡å™¨)
- [RTMP æ¨æµ](#rtmp-æ¨æµ)
- [RTSP ä»£ç†](#rtsp-ä»£ç†)
- [å½•åƒç®¡ç†](#å½•åƒç®¡ç†)
- [äº‘å°æ§åˆ¶ (PTZ)](#äº‘å°æ§åˆ¶-ptz)
- [å½•åƒå›æ”¾](#å½•åƒå›æ”¾)
- [æŠ¥è­¦äº‹ä»¶](#æŠ¥è­¦äº‹ä»¶)
- [å®æ—¶é€šçŸ¥ (SSE)](#å®æ—¶é€šçŸ¥-sse)
- [AI æ™ºèƒ½æ£€æµ‹](#ai-æ™ºèƒ½æ£€æµ‹)
- [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)
- [ç³»ç»ŸçŠ¶æ€](#ç³»ç»ŸçŠ¶æ€)
- [ZLM Webhook](#zlm-webhook)

---

## è®¤è¯æœºåˆ¶

å¤§å¤šæ•° API éœ€è¦é€šè¿‡ JWT è®¤è¯ã€‚ç™»å½•æˆåŠŸåä¼šè¿”å› tokenï¼Œä¹‹åçš„è¯·æ±‚éœ€è¦åœ¨ Header ä¸­æºå¸¦ï¼š

```
Authorization: Bearer <token>
```

---

## ç”¨æˆ·ç®¡ç†

### ç”¨æˆ·ç™»å½•

**POST** `/user/login`

ç”¨æˆ·ç™»å½•è·å– JWT Tokenã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | æ˜¯ | ç”¨æˆ·å |
| password | string | æ˜¯ | å¯†ç  |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "username": "admin",
  "password": "admin"
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": "admin"
}
```

### ä¿®æ”¹è´¦å·å¯†ç 

**PUT** `/user/user`

ä¿®æ”¹å½“å‰ç”¨æˆ·çš„è´¦å·å’Œå¯†ç ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | æ˜¯ | æ–°ç”¨æˆ·å |
| password | string | æ˜¯ | æ–°å¯†ç  |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "username": "newadmin",
  "password": "newpassword"
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "msg": "å‡­æ®æ›´æ–°æˆåŠŸ"
}
```

---

## è®¾å¤‡ç®¡ç†

### è·å–è®¾å¤‡åˆ—è¡¨

**GET** `/devices`

è·å–æ‰€æœ‰è®¾å¤‡åˆ—è¡¨ï¼ˆæ”¯æŒæ‰€æœ‰åè®®ï¼šGB28181ã€ONVIF ç­‰ï¼‰ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | int | å¦ | é¡µç  |
| page_size | int | å¦ | æ¯é¡µæ•°é‡ |
| type | string | å¦ | è®¾å¤‡ç±»å‹è¿‡æ»¤ |

**å“åº”ç¤ºä¾‹**:

```json
{
  "items": [...],
  "total": 10
}
```

### è·å–è®¾å¤‡è¯¦æƒ…

**GET** `/devices/:id`

æ ¹æ®è®¾å¤‡ ID è·å–è®¾å¤‡è¯¦æƒ…ã€‚

### æ·»åŠ è®¾å¤‡

**POST** `/devices`

æ·»åŠ æ–°è®¾å¤‡ï¼ˆé€šè¿‡ type å­—æ®µåŒºåˆ†åè®®ç±»å‹ï¼‰ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| type | string | æ˜¯ | è®¾å¤‡ç±»å‹ï¼šGB28181 æˆ– ONVIF |
| device_id | string | å¦ | è®¾å¤‡ IDï¼ˆGB28181 å¿…å¡«ï¼‰ |
| name | string | å¦ | è®¾å¤‡åç§° |
| ip | string | å¦ | IP åœ°å€ï¼ˆONVIF å¿…å¡«ï¼‰ |
| port | int | å¦ | ç«¯å£å·ï¼ˆONVIF å¿…å¡«ï¼‰ |
| username | string | å¦ | ç”¨æˆ·åï¼ˆONVIF å¿…å¡«ï¼‰ |
| password | string | å¦ | å¯†ç ï¼ˆONVIF å¿…å¡«ï¼‰ |

**GB28181 è®¾å¤‡ç¤ºä¾‹**:

```json
{
  "type": "GB28181",
  "device_id": "34020000001320000001",
  "name": "æ‘„åƒå¤´1"
}
```

**ONVIF è®¾å¤‡ç¤ºä¾‹**:

```json
{
  "type": "ONVIF",
  "ip": "192.168.1.100",
  "port": 80,
  "username": "admin",
  "password": "12345"
}
```

### ä¿®æ”¹è®¾å¤‡

**PUT** `/devices/:id`

ä¿®æ”¹è®¾å¤‡ä¿¡æ¯ã€‚

### åˆ é™¤è®¾å¤‡

**DELETE** `/devices/:id`

åˆ é™¤æŒ‡å®šè®¾å¤‡ã€‚

### åˆ·æ–°è®¾å¤‡é€šé“

**POST** `/devices/:id/catalog`

åˆ·æ–° GB28181 è®¾å¤‡çš„é€šé“ä¿¡æ¯ã€‚

**å“åº”ç¤ºä¾‹**:

```json
{
  "msg": "ok"
}
```

### è·å–è®¾å¤‡ä¸é€šé“åˆ—è¡¨

**GET** `/devices/channels`

è·å–è®¾å¤‡åŠå…¶é€šé“ä¿¡æ¯åˆ—è¡¨ã€‚

### ONVIF è®¾å¤‡å‘ç°

**GET** `/onvif/discover`

å‘ç°å±€åŸŸç½‘ä¸­çš„ ONVIF è®¾å¤‡ï¼ˆSSE æ¥å£ï¼‰ã€‚

---

## é€šé“ç®¡ç†

### è·å–é€šé“åˆ—è¡¨

**GET** `/channels`

è·å–æ‰€æœ‰é€šé“åˆ—è¡¨ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | int | å¦ | é¡µç  |
| page_size | int | å¦ | æ¯é¡µæ•°é‡ |
| device_id | string | å¦ | è®¾å¤‡ ID è¿‡æ»¤ |

### ä¿®æ”¹é€šé“

**PUT** `/channels/:id`

ä¿®æ”¹é€šé“ä¿¡æ¯ã€‚

### æ’­æ”¾é€šé“

**POST** `/channels/:id/play`

å¼€å§‹æ’­æ”¾æŒ‡å®šé€šé“ã€‚

**å“åº”ç¤ºä¾‹**:

```json
{
  "app": "rtp",
  "stream": "34020000001320000001",
  "expires_at": 1700000000,
  "items": [
    {
      "label": "é»˜è®¤çº¿è·¯",
      "ws_flv": "ws://host:15123/proxy/sms/rtp/34020000001320000001.live.flv",
      "http_flv": "http://host:15123/proxy/sms/rtp/34020000001320000001.live.flv",
      "rtmp": "rtmp://host:1935/rtp/34020000001320000001",
      "rtsp": "rtsp://host:554/rtp/34020000001320000001",
      "webrtc": "webrtc://host:15123/proxy/sms/index/api/webrtc?app=rtp&stream=34020000001320000001&type=play",
      "hls": "http://host:15123/proxy/sms/rtp/34020000001320000001/hls.fmp4.m3u8"
    }
  ]
}
```

### åˆ·æ–°å¿«ç…§

**POST** `/channels/:id/snapshot`

åˆ·æ–°é€šé“å¿«ç…§å›¾åƒã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| within_seconds | int | å¦ | æŒ‡å®šè·å–å¤šå°‘ç§’å†…åˆ›å»ºçš„å¿«ç…§ |
| url | string | å¦ | å–å¿«ç…§çš„é“¾æ¥åœ°å€ |

**å“åº”ç¤ºä¾‹**:

```json
{
  "link": "http://host:15123/channels/34020000001320000001/snapshot?token=xxx"
}
```

### è·å–å¿«ç…§

**GET** `/channels/:id/snapshot`

è·å–é€šé“å¿«ç…§å›¾åƒã€‚

---

## æµåª’ä½“æœåŠ¡å™¨

### è·å–æµåª’ä½“æœåŠ¡å™¨åˆ—è¡¨

**GET** `/media_servers`

è·å–æ‰€æœ‰æµåª’ä½“æœåŠ¡å™¨åˆ—è¡¨ã€‚

### ä¿®æ”¹æµåª’ä½“æœåŠ¡å™¨

**PUT** `/media_servers/:id`

ä¿®æ”¹æµåª’ä½“æœåŠ¡å™¨é…ç½®ã€‚

---

## RTMP æ¨æµ

### è·å–æ¨æµåˆ—è¡¨

**GET** `/stream_pushs`

è·å– RTMP æ¨æµåˆ—è¡¨ã€‚

**å“åº”ç¤ºä¾‹**:

```json
{
  "items": [
    {
      "id": "xxx",
      "app": "live",
      "stream": "test",
      "status": 1,
      "push_addrs": ["rtmp://host:1935/live/test?sign=xxx"]
    }
  ],
  "total": 1
}
```

### è·å–æ¨æµè¯¦æƒ…

**GET** `/stream_pushs/:id`

è·å–æŒ‡å®šæ¨æµè¯¦æƒ…ã€‚

### æ·»åŠ æ¨æµ

**POST** `/stream_pushs`

æ·»åŠ æ–°çš„æ¨æµé…ç½®ã€‚

### ä¿®æ”¹æ¨æµ

**PUT** `/stream_pushs/:id`

ä¿®æ”¹æ¨æµé…ç½®ã€‚

### åˆ é™¤æ¨æµ

**DELETE** `/stream_pushs/:id`

åˆ é™¤æ¨æµé…ç½®ã€‚

---

## RTSP ä»£ç†

### è·å–ä»£ç†åˆ—è¡¨

**GET** `/stream_proxys`

è·å– RTSP ä»£ç†æµåˆ—è¡¨ã€‚

### è·å–ä»£ç†è¯¦æƒ…

**GET** `/stream_proxys/:id`

è·å–æŒ‡å®šä»£ç†æµè¯¦æƒ…ã€‚

### æ·»åŠ ä»£ç†

**POST** `/stream_proxys`

æ·»åŠ æ–°çš„ä»£ç†æµé…ç½®ã€‚

### ä¿®æ”¹ä»£ç†

**PUT** `/stream_proxys/:id`

ä¿®æ”¹ä»£ç†æµé…ç½®ã€‚

### åˆ é™¤ä»£ç†

**DELETE** `/stream_proxys/:id`

åˆ é™¤ä»£ç†æµé…ç½®ã€‚

---

## å½•åƒç®¡ç†

### å¼€å§‹å½•åƒ

**POST** `/records/start`

å¼€å§‹å½•åƒã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| app | string | æ˜¯ | æµçš„åº”ç”¨åï¼Œä¾‹å¦‚ rtp |
| stream | string | æ˜¯ | æµ ID |
| type | int | å¦ | 0 ä¸º HLSï¼Œ1 ä¸º MP4 |
| max_second | int | å¦ | MP4 å½•åƒåˆ‡ç‰‡æ—¶é—´å¤§å°ï¼Œå•ä½ç§’ |
| customized_path | string | å¦ | å½•åƒæ–‡ä»¶ä¿å­˜è‡ªå®šä¹‰æ ¹ç›®å½• |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "app": "rtp",
  "stream": "34020000001320000001",
  "type": 1,
  "max_second": 3600
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "msg": "å½•åƒå·²å¼€å§‹"
}
```

### åœæ­¢å½•åƒ

**POST** `/records/stop`

åœæ­¢å½•åƒã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| app | string | æ˜¯ | æµçš„åº”ç”¨å |
| stream | string | æ˜¯ | æµ ID |
| type | int | å¦ | 0 ä¸º HLSï¼Œ1 ä¸º MP4 |

**å“åº”ç¤ºä¾‹**:

```json
{
  "msg": "å½•åƒå·²åœæ­¢"
}
```

### è·å–å½•åƒçŠ¶æ€

**GET** `/records/status`

è·å–æµçš„å½•åƒçŠ¶æ€ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| app | string | æ˜¯ | æµçš„åº”ç”¨å |
| stream | string | æ˜¯ | æµ ID |
| type | int | å¦ | 0 ä¸º HLSï¼Œ1 ä¸º MP4 |

**å“åº”ç¤ºä¾‹**:

```json
{
  "status": true
}
```

### è·å–å½•åƒæ–‡ä»¶åˆ—è¡¨

**GET** `/records/files`

è·å–å½•åƒæ–‡ä»¶åˆ—è¡¨ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| app | string | æ˜¯ | æµçš„åº”ç”¨å |
| stream | string | æ˜¯ | æµ ID |
| period | string | æ˜¯ | æ—¥æœŸï¼Œæ ¼å¼ä¸º 2020-02-01 |
| customize | string | å¦ | æ˜¯å¦ä¸ºè‡ªå®šä¹‰è·¯å¾„å½•åƒ |

**å“åº”ç¤ºä¾‹**:

```json
{
  "root_path": "/opt/media/record",
  "paths": ["file1.mp4", "file2.mp4"],
  "folders": []
}
```

---

## äº‘å°æ§åˆ¶ (PTZ)

### äº‘å°æ–¹å‘æ§åˆ¶

**POST** `/ptz/control`

æ§åˆ¶äº‘å°æ–¹å‘ã€å˜å€ã€å…‰åœˆã€èšç„¦ç­‰ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| device_id | string | æ˜¯ | è®¾å¤‡ ID |
| channel_id | string | æ˜¯ | é€šé“ ID |
| command | string | æ˜¯ | æ§åˆ¶å‘½ä»¤ |
| speed | int | å¦ | é€Ÿåº¦ (0-255), é»˜è®¤ 50 |

**æ”¯æŒçš„å‘½ä»¤**:

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| stop | åœæ­¢ |
| left | å·¦è½¬ |
| right | å³è½¬ |
| up | ä¸Šä»° |
| down | ä¸‹ä¿¯ |
| zoom_in | æ”¾å¤§ |
| zoom_out | ç¼©å° |
| left_up | å·¦ä¸Š |
| left_down | å·¦ä¸‹ |
| right_up | å³ä¸Š |
| right_down | å³ä¸‹ |
| iris_in | å…‰åœˆå¼€ |
| iris_out | å…‰åœˆå…³ |
| focus_in | èšç„¦è¿‘ |
| focus_out | èšç„¦è¿œ |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "device_id": "34020000001320000001",
  "channel_id": "34020000001320000001",
  "command": "left",
  "speed": 100
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "msg": "ok"
}
```

### é¢„ç½®ä½æ§åˆ¶

**POST** `/ptz/preset`

é¢„ç½®ä½è®¾ç½®ã€è°ƒç”¨ã€åˆ é™¤ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| device_id | string | æ˜¯ | è®¾å¤‡ ID |
| channel_id | string | æ˜¯ | é€šé“ ID |
| action | string | æ˜¯ | åŠ¨ä½œ: set, call, delete |
| preset_index | int | æ˜¯ | é¢„ç½®ä½ç¼–å· (1-255) |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "device_id": "34020000001320000001",
  "channel_id": "34020000001320000001",
  "action": "call",
  "preset_index": 1
}
```

---

## å½•åƒå›æ”¾

### å¼€å§‹å½•åƒå›æ”¾

**POST** `/playback/start`

å¼€å§‹è®¾å¤‡ç«¯å½•åƒå›æ”¾ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| channel_id | string | æ˜¯ | é€šé“ ID |
| start_time | int | æ˜¯ | å¼€å§‹æ—¶é—´æˆ³(ç§’) |
| end_time | int | æ˜¯ | ç»“æŸæ—¶é—´æˆ³(ç§’) |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "channel_id": "34020000001320000001",
  "start_time": 1700000000,
  "end_time": 1700003600
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "stream_id": "playback_34020000001320000001_20231115100000",
  "app": "rtp",
  "stream": "playback_34020000001320000001_20231115100000"
}
```

### åœæ­¢å½•åƒå›æ”¾

**POST** `/playback/stop`

åœæ­¢å½•åƒå›æ”¾ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| channel_id | string | æ˜¯ | é€šé“ ID |

### å›æ”¾æ§åˆ¶

**POST** `/playback/control`

å›æ”¾æ§åˆ¶ï¼ˆæš‚åœã€ç»§ç»­ã€å€é€Ÿï¼‰ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| device_id | string | æ˜¯ | è®¾å¤‡ ID |
| channel_id | string | æ˜¯ | é€šé“ ID |
| action | string | æ˜¯ | åŠ¨ä½œ: play, pause, scale |
| scale | float | å¦ | å€é€Ÿ (0.5, 1, 2, 4 ç­‰) |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "device_id": "34020000001320000001",
  "channel_id": "34020000001320000001",
  "action": "scale",
  "scale": 2.0
}
```

### æŸ¥è¯¢è®¾å¤‡ç«¯å½•åƒ

**GET** `/playback/records`

æŸ¥è¯¢è®¾å¤‡ç«¯å½•åƒä¿¡æ¯ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| device_id | string | æ˜¯ | è®¾å¤‡ ID |
| channel_id | string | æ˜¯ | é€šé“ ID |
| start_time | int | æ˜¯ | å¼€å§‹æ—¶é—´æˆ³(ç§’) |
| end_time | int | æ˜¯ | ç»“æŸæ—¶é—´æˆ³(ç§’) |

---

## æŠ¥è­¦äº‹ä»¶

### è®¢é˜…æŠ¥è­¦äº‹ä»¶

**POST** `/alarms/subscribe`

è®¢é˜…è®¾å¤‡æŠ¥è­¦äº‹ä»¶ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| device_id | string | æ˜¯ | è®¾å¤‡ ID |
| expire_seconds | int | å¦ | è®¢é˜…æœ‰æ•ˆæœŸ(ç§’), é»˜è®¤ 3600 |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "device_id": "34020000001320000001",
  "expire_seconds": 7200
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "msg": "ok",
  "expires": 7200
}
```

### å–æ¶ˆæŠ¥è­¦è®¢é˜…

**POST** `/alarms/unsubscribe`

å–æ¶ˆè®¾å¤‡æŠ¥è­¦è®¢é˜…ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| device_id | string | æ˜¯ | è®¾å¤‡ ID |

---

## å®æ—¶é€šçŸ¥ (SSE)

### è®¢é˜…å®æ—¶é€šçŸ¥

**GET** `/notifications/subscribe`

é€šè¿‡ Server-Sent Events (SSE) è®¢é˜…å®æ—¶æ¶ˆæ¯é€šçŸ¥ã€‚

**é€šçŸ¥ç±»å‹**:

| ç±»å‹ | è¯´æ˜ |
|------|------|
| device_online | è®¾å¤‡ä¸Šçº¿ |
| device_offline | è®¾å¤‡ç¦»çº¿ |
| stream_start | æµå¼€å§‹ |
| stream_stop | æµåœæ­¢ |
| record_start | å½•åƒå¼€å§‹ |
| record_stop | å½•åƒåœæ­¢ |
| error | é”™è¯¯é€šçŸ¥ |
| alarm | æŠ¥è­¦é€šçŸ¥ |
| alarm_subscribed | æŠ¥è­¦è®¢é˜…çŠ¶æ€å˜æ›´ |
| ai_alert | AI æ£€æµ‹å‘Šè­¦ |

**é€šçŸ¥æ ¼å¼**:

```json
{
  "id": "uuid",
  "type": "device_online",
  "message": "è®¾å¤‡ä¸Šçº¿",
  "data": {
    "device_id": "34020000001320000001",
    "device_name": "æ‘„åƒå¤´1",
    "online": true
  },
  "timestamp": 1700000000
}
```

---

## AI æ™ºèƒ½æ£€æµ‹

### æ‰§è¡Œ AI æ£€æµ‹

**POST** `/ai/detect`

æ‰§è¡Œ AI æ£€æµ‹ï¼ˆè¡Œäººã€è½¦è¾†ã€äººè„¸ç­‰ï¼‰ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| channel_id | string | æ˜¯ | é€šé“ ID |
| image_data | string | æ˜¯ | Base64 ç¼–ç çš„å›¾ç‰‡æ•°æ® |
| type | string | å¦ | æ£€æµ‹ç±»å‹: pedestrian/vehicle/face/object |

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "results": [
    {
      "label": "person",
      "confidence": 0.95,
      "box": {"x": 100, "y": 100, "width": 50, "height": 120}
    }
  ],
  "process_time_ms": 125.5,
  "alerts": []
}
```

### è·å–å‘Šè­¦è§„åˆ™åˆ—è¡¨

**GET** `/ai/rules`

è·å–æ‰€æœ‰ AI å‘Šè­¦è§„åˆ™ã€‚

**å“åº”ç¤ºä¾‹**:

```json
{
  "rules": [
    {
      "id": "uuid",
      "channel_id": "34020000001320000001",
      "detection_type": "pedestrian",
      "enabled": true,
      "threshold": 0.5,
      "cooldown_seconds": 60
    }
  ]
}
```

### åˆ›å»ºå‘Šè­¦è§„åˆ™

**POST** `/ai/rules`

åˆ›å»º AI å‘Šè­¦è§„åˆ™ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| channel_id | string | æ˜¯ | é€šé“ ID |
| detection_type | string | æ˜¯ | æ£€æµ‹ç±»å‹ |
| enabled | bool | å¦ | æ˜¯å¦å¯ç”¨ |
| threshold | float | å¦ | é˜ˆå€¼ (0-1)ï¼Œé»˜è®¤ 0.5 |
| cooldown_seconds | int | å¦ | å†·å´æ—¶é—´(ç§’)ï¼Œé»˜è®¤ 60 |
| region | object | å¦ | æ£€æµ‹åŒºåŸŸ |

### è·å–å‘Šè­¦è§„åˆ™è¯¦æƒ…

**GET** `/ai/rules/:id`

è·å–æŒ‡å®šå‘Šè­¦è§„åˆ™è¯¦æƒ…ã€‚

### æ›´æ–°å‘Šè­¦è§„åˆ™

**PUT** `/ai/rules/:id`

æ›´æ–°å‘Šè­¦è§„åˆ™ã€‚

### åˆ é™¤å‘Šè­¦è§„åˆ™

**DELETE** `/ai/rules/:id`

åˆ é™¤å‘Šè­¦è§„åˆ™ã€‚

### è·å– AI æœåŠ¡çŠ¶æ€

**GET** `/ai/status`

è·å– AI æœåŠ¡çŠ¶æ€ã€‚

**å“åº”ç¤ºä¾‹**:

```json
{
  "enabled": true,
  "inference_mode": "remote",
  "endpoint": "http://localhost:8080",
  "model_type": "yolov8",
  "rule_count": 5
}
```

---

## é…ç½®ç®¡ç†

### è·å–é…ç½®ä¿¡æ¯

**GET** `/configs/info`

è·å–ç³»ç»Ÿé…ç½®ä¿¡æ¯ã€‚

**å“åº”ç¤ºä¾‹**:

```json
{
  "sip": {
    "id": "34020000002000000001",
    "domain": "3402000000",
    "port": 15060
  },
  "play_expire_minutes": 10,
  "enable_snapshot_blur": false
}
```

### ä¿®æ”¹ SIP é…ç½®

**PUT** `/configs/info/sip`

ä¿®æ”¹ SIP é…ç½®ä¿¡æ¯ã€‚

### ä¿®æ”¹æœåŠ¡å™¨è®¾ç½®

**PUT** `/configs/info/server`

ä¿®æ”¹æœåŠ¡å™¨è®¾ç½®ã€‚

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| play_expire_minutes | int | å¦ | æ’­æ”¾é“¾æ¥æœ‰æ•ˆæœŸ(åˆ†é’Ÿ)ï¼Œ0 è¡¨ç¤ºä¸é™åˆ¶ |
| enable_snapshot_blur | bool | å¦ | æ˜¯å¦å¯ç”¨å¿«ç…§æ¯›ç»ç’ƒæ•ˆæœ |

---

## ç³»ç»ŸçŠ¶æ€

### å¥åº·æ£€æŸ¥

**GET** `/health`

è·å–ç³»ç»Ÿå¥åº·çŠ¶æ€ã€‚

**å“åº”ç¤ºä¾‹**:

```json
{
  "version": "1.0.0",
  "start_at": "2023-11-15T10:00:00Z",
  "git_branch": "main",
  "git_hash": "abc123"
}
```

### è·å– API æŒ‡æ ‡

**GET** `/app/metrics/api`

è·å– API è°ƒç”¨æŒ‡æ ‡ã€‚

**å“åº”ç¤ºä¾‹**:

```json
{
  "real_time_requests": 10,
  "total_requests": 10000,
  "total_responses": 9999,
  "request_top10": [
    {"key": "/devices", "value": 1000}
  ],
  "status_code_top10": [
    {"key": "200", "value": 9000}
  ],
  "goroutines": 50,
  "num_gc": 100,
  "sys_alloc": 52428800,
  "start_at": "2023-11-15 10:00:00"
}
```

---

## ZLM Webhook

è¿™äº›æ¥å£ç”± ZLMediaKit è°ƒç”¨ï¼Œç”¨äºæµåª’ä½“äº‹ä»¶å¤„ç†ã€‚

### æœåŠ¡å™¨å¿ƒè·³

**POST** `/webhook/on_server_keepalive`

æµåª’ä½“æœåŠ¡å™¨å®šæ—¶ä¸ŠæŠ¥å¿ƒè·³ã€‚

### æµå˜åŒ–äº‹ä»¶

**POST** `/webhook/on_stream_changed`

æµæ³¨å†Œæˆ–æ³¨é”€æ—¶è§¦å‘ã€‚

### æ¨æµé‰´æƒ

**POST** `/webhook/on_publish`

RTSP/RTMP/RTP æ¨æµé‰´æƒäº‹ä»¶ã€‚

### æ’­æ”¾é‰´æƒ

**POST** `/webhook/on_play`

æ’­æ”¾è§¦å‘æ’­æ”¾å™¨èº«ä»½éªŒè¯äº‹ä»¶ã€‚

### æ— äººè§‚çœ‹äº‹ä»¶

**POST** `/webhook/on_stream_none_reader`

æµæ— äººè§‚çœ‹æ—¶è§¦å‘ã€‚

### RTP æœåŠ¡å™¨è¶…æ—¶

**POST** `/webhook/on_rtp_server_timeout`

RTP æœåŠ¡å™¨è¶…æ—¶äº‹ä»¶ã€‚

### æµä¸å­˜åœ¨äº‹ä»¶

**POST** `/webhook/on_stream_not_found`

æµä¸å­˜åœ¨æ—¶è§¦å‘ã€‚

---

## é”™è¯¯å“åº”

æ‰€æœ‰æ¥å£åœ¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¼šè¿”å›ä»¥ä¸‹æ ¼å¼ï¼š

```json
{
  "code": 400,
  "msg": "é”™è¯¯ä¿¡æ¯"
}
```

**å¸¸è§é”™è¯¯ç **:

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒï¼ˆéœ€è¦ç™»å½•ï¼‰ |
| 403 | ç¦æ­¢è®¿é—® |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## ç›¸å…³é“¾æ¥

- [GoWVP GitHub ä»“åº“](https://github.com/gowvp/gb28181)
- [åœ¨çº¿æ¼”ç¤ºå¹³å°](http://gowvp.golang.space:15123/)
- [ZLMediaKit æ–‡æ¡£](https://github.com/ZLMediaKit/ZLMediaKit)
- [Apifox åœ¨çº¿ API æ–‡æ¡£](https://apifox.com/apidoc/shared-7b67c918-5f72-4f64-b71d-0593d7427b93)
